<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.32.3"/><title data-react-helmet="true"></title><link rel="icon" href="/favicon-32x32.png?v=9e52c959d7c51d416d3e44ec29212896" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=9e52c959d7c51d416d3e44ec29212896"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=9e52c959d7c51d416d3e44ec29212896"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=9e52c959d7c51d416d3e44ec29212896"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=9e52c959d7c51d416d3e44ec29212896"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=9e52c959d7c51d416d3e44ec29212896"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=9e52c959d7c51d416d3e44ec29212896"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=9e52c959d7c51d416d3e44ec29212896"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=9e52c959d7c51d416d3e44ec29212896"/><link as="script" rel="preload" href="/webpack-runtime-f44a1b84cfda6d704155.js"/><link as="script" rel="preload" href="/framework-741ade27086b2708e961.js"/><link as="script" rel="preload" href="/app-c2e8a8da9f4703c58898.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-9594e502097cd38e0d1e.js"/><link as="fetch" rel="preload" href="/page-data/blog/2020/creating-a-cypress-testing-environment-that-skips-authentication/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><article id="main"><header><a href="/blog"><h2>My Blog</h2></a><p>Those Who Dream The Most...Do The Most</p></header><section class="wrapper style5"><div class="inner"><h2>Creating A Cypress Test Environment To Skip Authentication</h2><p><em>February 25, 2020</em></p><div class="blog-post-content"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--GFNDCpp1--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/i/rotbsbnt350idbzu76ah.jpg" class="image" />
<h2>The Requirement</h2>
<p>I recently was tasked with finding a way to skip authentication to easily test our apps using the great End to End testing tool <a href="https://www.cypress.io/">Cypress</a>. Cypress does provide simple solutions for testing your app's authentication and authorization but in our scenario, we just wanted to skip it altogether. </p>
<h2>Some Context</h2>
<p>In our case, we wanted to use an in-house npm package that handles the authentication logic. All we need to do is just import that module into our <code>app.module</code> with an environment-specific identity configuration.</p>
<p><strong>With Authentication</strong></p>
<pre><code>
  @NgModule({
    imports: [InHouseIdentityModule.forRoot(environment.identityConfig)]
  })
  export class AppModule {}
</code></pre>
<p><strong>Without Authentication</strong></p>
<pre><code>
  @NgModule({
    imports: [InHouseIdentityModule.forRoot(null)]
  })
  export class AppModule {}
</code></pre>
<p>As you can see above, if <em>null</em> is passed into the <code>InHouseIdentityModule.forRoot()</code> method, it will skip authentication for our app.</p>
<h3>Creating e2e Environment</h3>
<p>The first thing we need to do is create a new environment. We will create an <code>environment.e2e.ts</code> to go inside the <code>/environments</code> directory with the rest of our environment configurations. We should then copy any app-specific configurations needed in addition to adding <em>identityConfig</em> equal to null. It should look something like this...</p>
<pre><code>
  export const environment: IEnvironment = {
    // your other app configurations
    identityConfig: null
  };
</code></pre>
<p>This will make sure that when the e2e configuration is used that null is passed into the identityModule and therefore skipping authentication. </p>
<p>The next thing we need to do is configure <em>angular.json</em> to build our e2e configuration. </p>
<pre><code>
  {
    "projects": {
      "appName": {
        "architect": {
          "build": {
            "configuration": {
              "e2e": {
                "fileReplacements": [
                  {
                    "replace": "src/environments/environment.ts",
                    "with": "src/environments/environment.e2e.ts"
                  }
                ]
              }
            }
          },
          "serve": {
            "configurations": {
              "e2e" {
                "browserTarget": "auto:build:e2e"
              }
            }
          }
        }
      }
    }
  }
</code></pre>
<p>Here we are telling angular to replace <code>environment.ts</code> with <code>environment.e2e.ts</code> when using the build configuration <em>e2e</em>. We then tell angular that when we serve the app with the <em>e2e</em> configuration, it will target the e2e build. </p>
<p>Finally, let's create a script in our <code>package.json</code> to easily build and serve our app using the new e2e configuration. </p>
<pre><code>
  {
    "scripts": {
      "start:e2e": "ng serve --configuration=\"e2e\"",
      "build:e2e": "ng build --configuration=\"e2e\""
    }
  }
</code></pre>
<p>Now if we run our app by using <code>npm run start:e2e</code> the app will serve and it will skip authentication!</p>
<p><strong>BONUS</strong>
If you need to be able to run cypress headlessly in your CI pipeline, you can add the following script to your <code>package.json</code>:</p>
<p><code>"cypress:ci": "start-server-and-test start:e2e http-get://localhost:4200 cypress:run",</code></p></div><a class="button small icon solid fa-chevron-left" href="/blog">Back To Blog</a></div></section></article></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2020/creating-a-cypress-testing-environment-that-skips-authentication";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2966d4d8fea208fd6f8f.js"],"app":["/app-c2e8a8da9f4703c58898.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-0f40d706ebc58d78c1f6.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f21aaa73de4b20f7d55b.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-0f6860a5110f1e02d298.js"],"component---src-pages-index-js":["/component---src-pages-index-js-ae521135a624f2ab3a03.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-9594e502097cd38e0d1e.js"]};/*]]>*/</script><script src="/polyfill-2966d4d8fea208fd6f8f.js" nomodule=""></script><script src="/component---src-templates-blog-template-js-9594e502097cd38e0d1e.js" async=""></script><script src="/app-c2e8a8da9f4703c58898.js" async=""></script><script src="/framework-741ade27086b2708e961.js" async=""></script><script src="/webpack-runtime-f44a1b84cfda6d704155.js" async=""></script></body></html>